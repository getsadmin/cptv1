<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Commerical Tracker</title>
    <link rel="stylesheet" href="style1.css" />
    <link rel="stylesheet" href="style.css">
    <!-- Boxicons CSS -->
    <link flex href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet" />
    <script src="script1.js" defer></script>
  </head>
  <body>
    <nav class="sidebar locked">
      <div class="logo_items flex">
        <span class="nav_image">
          <img src="images/white_logo.png" alt="logo_img" />
        </span>
        <span class="logo_name">GalaxiETS</span>
        <i class="bx bx-lock-alt" id="lock-icon" title="Unlock Sidebar"></i>
        <i class="bx bx-x" id="sidebar-close"></i>
      </div>

      <div class="menu_container">
        <div class="menu_items">
          <ul class="menu_item">
            <div class="menu_title flex">
              <span class="title">Main</span>
              <span class="line"></span>
            </div>
            <li class="item">
              <a href="dashboard.html" class="link flex">
                <i class="bx bx-home-alt"></i>
                <span>DashBoard</span>
              </a>
            </li>
          
          </ul>

          <ul class="menu_item">
            <div class="menu_title flex">
              <span class="title">Storing</span>
              <span class="line"></span>
            </div>
            <li class="item">
              <a href="companydata.html" class="link flex"> 
               
                <i class='bx bx-notepad'></i>
                <span>Company Data</span>
              </a>
            </li>
            <li class="item">
              <a href="customerdata.html" class="link flex">
                <i class="bx bx-folder"></i>
                
                <span>Customer Data</span>
              </a>
            </li>
            <li class="item">
              <a href="projectdata.html" class="link flex">
                <i class='bx bxs-message-square-detail'></i>
              
                <span>Project Data</span>
              </a>
            </li>
          </ul>

          <ul class="menu_item">
            <div class="menu_title flex">
              <span class="title">Generator</span>
              <span class="line"></span>
            </div>
            <li class="item">
              <a href="quotation.html" class="link flex">
                <i class='bx bxs-notepad'></i>
                <span>Quotation</span>
              </a>
            </li>
            <li class="item">
              <a href="pogenerator.html" class="link flex">
                <i class="bx bx-grid-alt"></i>
             
                <span>PO</span>
              </a>
            </li>
            <li class="item">
              <a href="invoice.html" class="link flex">
                <i class='bx bxs-receipt' ></i>
                <span>Invoice</span>
              </a>
            </li>
          </ul>

          <ul class="menu_item">
            <div class="menu_title flex">
              <span class="title">Upload</span>
              <span class="line"></span>
            </div>
            <li class="item">
              <a href="po.html" class="link flex">
                <i class="bx bx-cloud-upload"></i>
                <span>PO</span>
              </a>
            </li>
          </ul>
          <ul class="menu_item">
            <div class="menu_title flex">
              <span class="title">Closure</span>
              <span class="line"></span>
            </div>
            <li class="item">
              <a href="payments.html" class="link flex">
                <i class='bx bx-credit-card'></i>
                <span>Payments</span>
              </a>
            </li>
            <li class="item">
              <a href="trackers.html" class="link flex">
                <i class='bx bx-line-chart'></i>
                <span>Tracker</span>
              </a>
            </li>
            <li class="item">
              <a href="close.html" class="link flex">
                <i class='bx bx-x'></i>
                <span>Close</span>
              </a>
            </li>
          </ul>
        </div>
        <div class="sidebar_profile">
          <div class="nav_image">
            <img src="images/adminprofile.jpg" alt="logo_img"/>
            <span class="name">Admin</span>
          </div>
            <div class="out">
              <a href="signin.html" class="log-out">
                <i class='bx bx-log-out'></i>
   </a> </div>
          </div>  
        </div>
        
      </div>
    </nav>
  <main>
     <div class="form-container">
       <h1>Company Details</h1>
       <form action="/companyData" method="POST" id="companyForm" class="form">
         <div class="container1">
           <div class="input-box">
             <label>Customer Address</label>
             <input type="text" name="CustomerAddress" placeholder="Enter Customer Address" required />
           </div>
           <div class="input-box">
             <label>Branch Address</label>
             <input type="text" name="BranchAddress" placeholder="Enter Branch Address" required />
           </div>
           <div class="column">
             <div class="input-box">
               <label>Customer ID</label>
               <input type="text" name="CustomerID" placeholder="Enter Customer ID" required />
             </div>
             <div class="input-box">
               <label>Customer Name</label>
               <input type="text" name="CustomerName" placeholder="Enter Customer Name" required />
             </div>
             <div class="input-box">
               <label>State code</label>
               <input type="number" name="Statecode" placeholder="Enter State code" required />
             </div>
           </div>
           <div class="column">
             <div class="input-box">
               <label>GST</label>
               <input type="text" name="GST" placeholder="Enter GST" required />
             </div>
             <div class="input-box">
               <label>Date Validity</label>
               <input type="date" name="DateValidity" required />
             </div>
             <div class="input-box">
               <label>ARN No</label>
               <input type="number" name="ARNNo" placeholder="Enter ARN number" required />
             </div>
           </div>
         </div>
         <br>
         <div>
          <!-- <button onclick="addCompanyData()">Add</button><br> -->
          <button type="button" class="button delete-button" style="vertical-align:middle"><span>Delete</span></button>
                <!-- <button type="button" class="button edit-button" style="vertical-align:middle"><span>Edit</span></button> -->
                <button type="submit"  class="button save-button" style="vertical-align:middle" onclick="addCompanyData()"><span>Save</span></button>
         </div>
       </form>
     </div>
     <div class="table-container">
       <table id="customerDataTable">
         <thead>
           <tr>
             <th>Customer Address</th>
             <th>Branch Address</th>
             <th>Customer ID</th>
             <th>Customer Name</th>
             <th>State Code</th>
             <th>GST</th>
             <th>Date Validity</th>
             <th>ARN No</th>
             <th>Action</th>
           </tr>
         </thead>
         <tbody>
           <!-- Table Body Content -->
         </tbody>
       </table>
</div>

      </section>
      <br>
      <p class="copyright">
        &copy; 2024 - <span>GALAXIETS</span> All Rights Reserved.
      </p>
      </main>
     </div>
   </main>

   <script src="script.js"></script>
   
   <script>
   
      document.addEventListener("DOMContentLoaded", function () {
          loadStoredCompanyData();
      });
  
      function addCompanyData() {

   
        let formData = new FormData(document.getElementById("companyForm"));
        let jsonData = {};
        formData.forEach((value, key) => {
            jsonData[key] = value;
        });

        fetch('/companyData', {
          method: 'POST',
          headers: {
              'Content-Type': 'application/json'
          },
          body: JSON.stringify(jsonData)
      })
      .then(response => {
          if (!response.ok) {
              throw new Error('Network response was not ok');
          }
          return response.json();
      })
      .then(data => {
          console.log('Data successfully saved:', data);
          // You can update the UI or do something else after successful submission
      })
      .catch(error => console.error('Error:', error));

          let customerAddress = document.getElementsByName("CustomerAddress")[0].value;
          let branchAddress = document.getElementsByName("BranchAddress")[0].value;
          let customerID = document.getElementsByName("CustomerID")[0].value;
          let customerName = document.getElementsByName("CustomerName")[0].value;
          let stateCode = document.getElementsByName("Statecode")[0].value;
          let gst = document.getElementsByName("GST")[0].value;
          let dateValidity = document.getElementsByName("DateValidity")[0].value;
          let arnNo = document.getElementsByName("ARNNo")[0].value;
  
          let table = document.getElementById("customerDataTable");
          let newRow = table.insertRow(table.rows.length);
  
          let cell1 = newRow.insertCell(0);
          let cell2 = newRow.insertCell(1);
          let cell3 = newRow.insertCell(2);
          let cell4 = newRow.insertCell(3);
          let cell5 = newRow.insertCell(4);
          let cell6 = newRow.insertCell(5);
          let cell7 = newRow.insertCell(6);
          let cell8 = newRow.insertCell(7);
          let cell9 = newRow.insertCell(8);
  
          cell1.innerHTML = customerAddress;
          cell2.innerHTML = branchAddress;
          cell3.innerHTML = customerID;
          cell4.innerHTML = customerName;
          cell5.innerHTML = stateCode;
          cell6.innerHTML = gst;
          cell7.innerHTML = dateValidity;
          cell8.innerHTML = arnNo;
          cell9.innerHTML = '<button onclick="deleteData(this)">Delete</button>';
  
          clearCustomerInputs();
  
          let newCompanyData = {
              customerAddress: customerAddress,
              branchAddress: branchAddress,
              customerID: customerID,
              customerName: customerName,
              stateCode: stateCode,
              gst: gst,
              dateValidity: dateValidity,
              arnNo: arnNo,
          };
  
          let existingCompanyData = JSON.parse(localStorage.getItem('companyData')) || [];
          existingCompanyData.push(newCompanyData);
          localStorage.setItem('companyData', JSON.stringify(existingCompanyData));

               // Generate a unique ID for the new row
        let companyId = generateUniqueId(); // Call a function to generate a unique ID

        // Add the generated ID to the row as a data attribute
        newRow.setAttribute('data-id', companyId);

        // Function to generate a unique ID
        function generateUniqueId() {
          // Generate a timestamp-based ID
          return Date.now().toString(36) + Math.random().toString(36).substr(2, 5);
      }


      }
  
      function loadStoredCompanyData() {
          let storedCompanyData = JSON.parse(localStorage.getItem('companyData')) || [];
          let table = document.getElementById("customerDataTable");

          // Clear table body content before loading stored data
        //table.getElementsByTagName('tbody')[0].innerHTML = '';
  
          storedCompanyData.forEach(function (data) {
              let newRow = table.insertRow(table.rows.length);
              newRow.innerHTML = `
                  <td>${data.customerAddress}</td>
                  <td>${data.branchAddress}</td>
                  <td>${data.customerID}</td>
                  <td>${data.customerName}</td>
                  <td>${data.stateCode}</td>
                  <td>${data.gst}</td>
                  <td>${data.dateValidity}</td>
                  <td>${data.arnNo}</td>
                  <td>
                    <button onclick="deleteData(this)">Delete</button>
                  </td>
              `;
          });
      }
  
      function clearCustomerInputs() {
          document.getElementsByName("CustomerAddress")[0].value = "";
          document.getElementsByName("BranchAddress")[0].value = "";
          document.getElementsByName("CustomerID")[0].value = "";
          document.getElementsByName("CustomerName")[0].value = "";
          document.getElementsByName("Statecode")[0].value = "";
          document.getElementsByName("GST")[0].value = "";
          document.getElementsByName("DateValidity")[0].value = "";
          document.getElementsByName("ARNNo")[0].value = "";
      }

  



    // Function to delete data
    function deleteData(button) {
        let row = button.parentNode.parentNode;
        let rowIndex = row.rowIndex - 1; // Adjust for header row
        let storedData = JSON.parse(localStorage.getItem('companyData')) || [];
        storedData.splice(rowIndex, 1); // Remove the corresponding data row
        localStorage.setItem('companyData', JSON.stringify(storedData));

        // Remove the row from the table
        row.parentNode.removeChild(row);

        // Deleting a company
async function deleteCompany(companyId) {
  try {
      const response = await fetch(`/companyData/${companyId}`, {
          method: 'DELETE',
      });
      
      if (response.ok) {
          console.log("Company deleted successfully");
          // Optionally, you can handle UI updates here
      } else {
          console.error("Failed to delete company");
          // Handle error response
      }
  } catch (error) {
      console.error("Error deleting company:", error);
      // Handle network errors
  }
}

        
deleteCompany(companyId);
        
    }
  
    
    



</script>
  
 
 </body>
 
 </html>
 